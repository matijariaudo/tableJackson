<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="theme-color" content="#000" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  
  <title>Document</title>
  <style>
  body{
    background-color: #e7e7e7;
    color:#525252;
    font-family: 'Fredoka', sans-serif;
  }
  

  table td,th{
    padding: 3px;
    font-size: .8em;
    margin:0px
  }

  thead{
    background-color: #686868;
    color:#000000;
  }
  td{
   
    color:#FFF ;
  }  
  th,td{border: 1px solid #FFF;
    border-width: 0px 0px 0px 1px;
    white-space: nowrap;
  }
  tr{
    border: 0px solid #000;
  }

  /* Ocultar el input file */
  input[type="file"] {
    display: none;
  }
  #image-container {
            width: 100%;
            height: 60vh;
            overflow: hidden;
            border-radius: 20px;
        }
        #image {
            max-width: 100%;
            display: block;
            margin: 0 auto;
        }

  .choosen{
    border-radius: 10px;
    padding:5px 30px;
    margin-top: 5px;
    margin-left: 5px;
    border: 0px;
    
  }
  .capa{
    margin: 0px;
    padding: 0px;
    overflow-y: auto;
  }
  .capa_0,.capa_00{
    height: 100vh;
    margin:0px
  }
  ::-webkit-scrollbar {
      height: 0px;
  }

  ::-webkit-scrollbar-thumb {
      background: #154732;
      border-radius: 5px;
  }

  ::-webkit-scrollbar-track:horizontal {
      background-color: #f2f2f2;
      border: 0px solid #f2f2f2;
  }
  </style>
</head>
<body>
  <div class="navbar fixed-top row capa_no capa_10_no capa_100_no capa_101_no capa_0_no p-0" style="padding: 10px 0px;background-color: #000000;color:#FFF;margin: 0px;text-align: center;">
    <div class="row col-md-6 offset-md-3 col-12" style="padding-bottom: 5px;">
    <div class="col-12 col-lg-2 p-2">
      <img src="img/logo.webp" alt="" style="width: 90px;margin-top: 5px;">
    </div>
    <div class="col-10 col-lg-8 p-2">
      <input type="text" id="txt_buscar" class="form-control" placeholder="Product, code or supplier.." style="width: 100%;background-color:rgba(255,255,255,.12);border:0px;border-radius: 100px;color:#FFCC00;">
    </div>
    <div class="col-2 col-lg-1 p-2">
      <button class="btn" style="background-color: #7c7c7c;border-radius: 100px;padding: 5px 12px;" onclick="$('#inputImage').click()">+</button>
    </div>
    </div>
  </div>
  <div class="container-fluid"  style="padding: 0px;;margin: 0px;padding: 0px;">
    <div class="capa capa_0 row" style="background: #000;text-align: center;">
    <div class="offset-4 col-4" style="margin-top: 30vh; color:#FFF"><img src="https://blog.roberthallam.org/wp-content/uploads/2022/09/loading-win98-transparent.gif" style="width: 100%;max-width: 80px;filter: invert(1);"><br>Loading..</div>
    </div>
    <div class="capa capa_00 row" style="background: #ffffff;text-align: center;">
      <div class="offset-4 col-4" style="margin-top: 30vh; color:#000000"><img src="https://blog.roberthallam.org/wp-content/uploads/2022/09/loading-win98-transparent.gif" style="width: 100%;max-width: 80px;"><br>Loading..</div>
      </div>
    <div class="capa capa_1 row  m-0" style="padding: 120px 10px 30px 10px;">
      <div class="col-12 p-0" style="overflow-x: auto;text-align: center;">
        <p style="text-align: left;margin: 0px;">Date:</p>
        <center><div id="date_filter" style="padding: 5px 0px;width: 480px;">
          <button class="btn btn_date" data-date="day" style="padding:5px 10px;border-radius:100px;background:#EAEAEA;color:#000;margin:3px;width:100px;border:1px solid #333">Today</button>
          <button class="btn btn_date" data-date="week" style="padding:5px 10px;border-radius:100px;background:#EAEAEA;color:#000;margin:3px;width:100px;border:1px solid #333">This week</button>
          <button class="btn btn_date" data-date="7days" style="padding:5px 10px;border-radius:100px;background:#EAEAEA;color:#000;margin:3px;width:100px;border:1px solid #333">Last week</button>
          <button class="btn btn_date" data-date="month" style="padding:5px 10px;border-radius:100px;background:#EAEAEA;color:#000;margin:3px;width:140px;border:1px solid #333">This month</button>
        </div></center>
      </div>
      <div class="col-12 p-0" style="overflow-x: auto;text-align: center;">
        <p style="text-align: left;margin: 0px;">Supplier:</p>
        <center><div id="categories" style="padding: 5px 0px;"></div></center>
      </div>
      <div class="row col-md-6 offset-md-3 col-12" id="products">
        
      </div>
    </div>
    <div class="capa capa_100 row" style="padding-top: 30px;background-color: #000;color:#FFF">
      <div class="container">
          <input type="file" class="form-control mt-3 mb-3" id="inputImage">
        <div class="col-12" style="margin-top: 20px;">
          <div id="result" class="mt-3">
            <img id="croppedImage" src="" alt="Cropped Image" class="img-fluid" style="max-width: 100%;display: none;border: 2px solid #FFF;">
        </div>
        </div>      
        <div class="col-12 " id="upload_choosen" style="padding: 0px 0px 10px 0px;display: none;">
          <h3 style="margin-top: 20px; text-align: center;">Match columns & data</h3>
          <input type="checkbox" id="headers_check" onchange="print_table()">Headers
          <div class="table-responsive"  id="table_read" style="max-height: 60vh;border:2px solid #FFF;padding:0px;border-radius: 10px;"></div>
          <div class="options col-12" style="text-align: left;">
          <div class="col-12" style="padding: 30px ;text-align: center;">
            <button class="btn btn-danger" data="1" style="margin-bottom: 10px;" onclick="capa(1)">Cancel</button>
            <button class="btn btn-success" data="1" style="margin-bottom: 10px;" onclick="createForm()">Next Step</button>
          </div>
          </div>
          <div class="col-12" style="padding:0px;font-size: .6em;margin-bottom: 70px;">User Id: <b class="user_id"></b> </div>  
        </div>
      </div>
    </div>
    <div class="capa capa_101 row" style="padding-top: 30px;background-color: #000;color:#FFF">
      <div class="col-12">
      <h3 style="margin: 20px 0px; text-align: center;">Upload Products</h3>
      <div class="col-12" style="border:1px solid #FFF;border-width: 2px 0px 2px 0px;padding-top: 30px;">
        Supplier: <select id="old_suppliers" onchange="$('#form_suplier').val($(this).val());$(this).val()==''?$('#form_suplier_div').show():$('#form_suplier_div').hide()" style="background: none;border:1px solid #FFF;border-radius: 4px;color:#FFF;margin-bottom:10px"></select> <br>
        <div id="form_suplier_div">
        New Supplier: <input type="text"  id="form_suplier" style="background: none;border:1px solid #FFF;border-radius: 4px;color:#FFF;margin-bottom:10px">
        </div>
        Date: <input type="datetime-local" id="form_date" style="background: none;border:1px solid #FFF;border-radius: 4px;margin-bottom: 30px;color: #FFF;">
      </div>
      <div class="col-12" id="div_form"></div>
      <div class="col-12" style="padding: 30px ;text-align: center;">
        <button class="btn btn-danger" data="1" style="margin-bottom: 10px;" onclick="capa(100)">Go Back</button>
        <button class="btn btn-success" data="1" style="margin-bottom: 10px;" id="enviar_form">Send Form</button>
      </div>
      
      </div>
    </div>
    <div class="capa capa_10 row" style="margin: 0px;padding: 50px 0px 0px 0px;background-color: #000;text-align: center;">
      <div class="col-12">
        <div id="image-container" style="border: 2px solid #FFF;">
            <img id="image" src="" style="display: none;" alt="Image for cropping and rotating">
        </div>
      </div>
      <div class="mt-3 text-center">
        <button onclick="capa(1)" class="btn btn-danger ">Delete</button> <button id="crop" class="btn btn-success">Continue</button>
      </div>
    </div>
    <div class="capa capa_3 row" style="padding: 40px 30px;background: #000;min-height: 100%;">
      <div class="col-12">
      <center><img src="img/loading.gif" style="width: 90px;" id="img_show_loading"></center>
      <img src="" alt="" id="img_show" onload="$(this).show();$('#img_show_loading').hide()" style="width: 100%;border:1px solid #FFF">
      <button class="btn" onclick="capa(1)" style="border-radius:100px;background:rgb(100,100,100);color:rgba(200,200,200);margin-top:30px">
        <i class="zmdi zmdi-arrow-left"></i>
        Go back
      </button>
    </div>
    </div>
  </div>

  <div class="modal" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header" style="border:0px">
              <h5 class="modal-title">DELETE</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body delete delete_1">
                <center><div class="lds-ring"><div></div><div></div><div></div><div></div></div></center>
            </div>
            <div class="modal-body delete delete_2" style="text-align: center;">
                <p>Are you sure of delete this register??</p>
                <b id="n1">4</b>+<b id="n2">3</b>=
                <input type="number" id="delete_rta" style="width: 30px;border-width: 0px 0px 2px 0px;">
                <p style="font-style: italic;font-size: .8em;">*Complete the sum to confirm</p>
                <input type="hidden" id="delete_id">
                <input type="hidden" id="delete_sum">
                <p id="delete_problem" style="color: red;"></p>
            </div>
            <div class="modal-footer create create_2 style="border:0px">
              <button type="button" class="btn" onclick="sendDelete()">Send</button>
            </div>
          </div>
        </div>
    </div>

  <nav class="navbar fixed-bottom " style="padding: 0px;box-shadow: -2px 5px 30px -5px rgba(66, 66, 66, 0.75);display: none;">
    <div class="col-6 nav_div nav_div_1" onclick="capa(1)" style="padding: 20px 10px;"><i class="zmdi zmdi-format-list-bulleted"></i> PRODUCTS</div>
    <div class="col-6 nav_div nav_div_2" onclick="capa(2)" style="padding: 20px 10px"><i class="zmdi zmdi-collection-music"></i> SUPPLIERS</div>
  </nav>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Bootstrap JS (optional) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script>

    function capa(i){
      $(".capa").hide();
      $(".capa_"+i).show();
      $(".capa_no").show();
      $(".capa_"+i+"_no").hide();
      $('.nav_div').css('color','#FFF');
      $(".nav_div_"+i).css('color','#FFCC00');
      console.log("capa",i)
    }
    
    capa(0)
    
    let cropper;
    const image = document.getElementById('image');
    const inputImage = document.getElementById('inputImage');
    const croppedImage = document.getElementById('croppedImage');

    inputImage.addEventListener('change', function(event) {
        capa(10)
        $("#image").show()
        const files = event.target.files;
        if (files && files.length > 0) {
            const file = files[0];
            const url = URL.createObjectURL(file);
            image.src = url;
            if (cropper) {
                cropper.destroy();
            }
            cropper = new Cropper(image, {
                viewMode: 1,
                dragMode: 'move',
                autoCropArea: 1,
                responsive: true,
                restore: true,
                movable: true,
                rotatable: true,
                scalable: true,
                zoomable: true,
                zoomOnTouch: true,
                zoomOnWheel: true,
                cropBoxResizable: true,
            });
        }
    });

    document.getElementById('crop').addEventListener('click', function() {
        const canvas = cropper.getCroppedCanvas();
        croppedImage.src = canvas.toDataURL();
        canvas.toBlob(function(blob) {
            uploadCroppedImage(blob);
        });
    });


    tableData=[]
    function uploadCroppedImage(blob){
        capa(0)
        const formData = new FormData();
        formData.append('archivo', blob);
        $.ajax({
        url: '/upload', // URL del servidor donde se enviarán los datos
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
            console.log(response)
            const rta=response.contenido;
            tableData=rta;
            capa(100)
            $("#headers_check").prop('checked',false)
            print_table();
            $("#croppedImage").show();
            $("#upload_choosen").show()
            //initsearch()
            
        },
        error: function(error) {
            // Manejar errores si ocurren
        }
        });
    } 
    
    function uploadCroppedImage2(){
        capa(0)
        $.ajax({
        url: '/upload2', // URL del servidor donde se enviarán los datos
        type: 'POST',
        success: function(response) {
            console.log(response)
            const rta=response.contenido;
            tableData=rta;
            console.log(tableData)
            capa(100)
            $("#headers_check").prop('checked',false)
            print_table();
            $("#croppedImage").hide();
            $("#upload_choosen").show()
            //initsearch()
            
        },
        error: function(error) {
            // Manejar errores si ocurren
        }
        });
    } 
    
    const print_table=()=>{
      cabecera=$("#headers_check").prop('checked');
      $("#table_read").html("");
      html="";cabecera?limit=0:limit=1000
      tableData.forEach(t => {
      html+=`<table class="ui celled table" style="margin:0px">`;
      qty=t[0].length;
      cab="<thead style='background:#FFF;color:#000'><tr>"
      for (let i = 0; i < qty; i++) {
        cab+=`<th><select class="choosen_col" style="min-width:60px"><option Value="NO">Choose</option><option value="qty">Quantity</option><option value="code">Code</option><option value="price">Price</option><option value="pricet">Total Price</option><option value="product">Product</option></select></th>` 
      }
      cab+=`</tr></thead>`;
      html+=cab;
      console.log(t)
      t.forEach((c,i) => {
         console.log(c)
          columna=""
          i==limit?columna+=`<thead><tr>`:html+=`<tr>`;
          c?.forEach(r => {
          i==limit?columna+=`<th>${r}</th>`:columna+=`<td>${r}</td>`;
          });
          i==limit?columna+=`</tr></thead>`:html+=`</tr>`;
          html+=columna;
      });
      html+=`</table>`;
      });
      $("#table_read").html(html);
    }

    function createForm(){
      const cabecera=$("#headers_check").prop('checked');
      $("#div_form").html("");
      html="";cabecera?limit=0:limit=1000
      n=0;pos={}
      $(".choosen_col").each(function(e){
        pos[$(this).val()]=n;
        n++;
      })

      tableData.forEach(t => {
      html+=`<div class="row p-2">`;
      p=0;
      t.forEach((c,i) => {
          console.log("AAA",c)
          if(i!=limit && c){
            html+=`
            <div class="col-1" style="padding:2px"><input  id="valid_${p}" type="checkbox" checked  style="max-width:100%;margin-top:30px;color:#FFF;background:rgb(255,255,255,.1);border:1px solid #FFF;border-radius:3px"></div>
            <div class="col-11"style="padding:2px">Product<br><input id="product_${p}"  type="text" style="color:#FFF;background:none;border:0px;color:#FFCC00;width:100%" value="${c[pos.product] || ""}" style="max-width:100%;min-width:100%"></div>
            <div class="col-3" style="padding:2px">Qty<br><input  id="qty_${p}" type="text" value="${c[pos.qty] || ""}"  style="max-width:100%;color:#FFF;background:rgb(255,255,255,.1);border:1px solid #FFF;border-radius:3px"></div>
            <div class="col-3" style="padding:2px">Code<br><input id="code_${p}" type="text" value="${c[pos.code] || ""}"  style="max-width:100%;color:#FFF;background:rgb(255,255,255,.1);border:1px solid #FFF;border-radius:3px"></div>
            <div class="col-3" style="padding:2px">Price<br><input  id="price_${p}" type="text" value="${c[pos.price] || ""}"  style="max-width:100%;color:#FFF;background:rgb(255,255,255,.1);border:1px solid #FFF;border-radius:3px"></div>
            <div class="col-3" style="padding:2px">Total<br><input  id="pricet_${p}" type="text" value="${c[pos.pricet] || ""}"  style="max-width:100%;color:#FFF;background:rgb(255,255,255,.1);border:1px solid #FFF;border-radius:3px"></div>
            `
          p++;
          }
      });
      html+=`</div>`;
      });
      $("#div_form").html(html);
      $("#div_form").append(`<input type='hidden' id="total_reg" value='${p}'>`);
      capa(101)
      $("#form_suplier_div").hide();
      $("#form_suplier").val("NO");
      $("#form_date").val(hora())
    }

    function hora(){
      // Obtener la fecha actual
      let now = new Date();
      // Formatear la fecha en 'YYYY-MM-DDTHH:MM'
      let year = now.getFullYear();
      let month = String(now.getMonth() + 1).padStart(2, '0');
      let day = String(now.getDate()).padStart(2, '0');
      let hours = String(now.getHours()).padStart(2, '0');
      let minutes = String(now.getMinutes()).padStart(2, '0');

      return `${year}-${month}-${day}T${hours}:${minutes}`;
    }

    $("#enviar_form").on('click',()=>{
       data=[]
       for (let i = 0; i < $('#total_reg').val(); i++) {
        if($("#valid_"+i).prop('checked') && $("#product_"+1).val().trim()!=""){
        data.push({product:$('#product_'+i).val(),qty:$('#qty_'+i).val(),code:$('#code_'+i).val(),price:$('#price_'+i).val(),pricet:$('#pricet_'+i).val()})
        }
      }
      console.log({reg:data,date:$("#form_date").val(),suplier:$("#form_suplier").val()})
      $.ajax({
        url: '/uploadproduct', // URL del servidor donde se enviarán los datos
        type: 'POST',
        data: JSON.stringify({reg:data,date:$("#form_date").val(),suplier:$("#form_suplier").val()}),
        contentType: 'application/json',
        success: function(response) {
          capa("00")
          getRegistros();
        }})
    })

    

    suppliers=[];suppliersSelected="all"
    const getRegistros=()=>{
      $.ajax({
        url: '/getproduct', // URL del servidor donde se enviarán los datos
        type: 'POST',
        data: JSON.stringify({}),
        contentType: 'application/json',
        success: function(r) {
          html=``
          dateAct=""
          suppliers=[];
          r.data.forEach(e => {
            if(!areDatesSameDay(dateAct,e.dateArrive)){
              dateAct=e.dateArrive
              html+=`<div class="col-12" style="padding:4px 8px;text-align:center">
                <hr style="margin:0px 0px 5px 0px">
                <h5>${formatDate(e.dateArrive).split(" ")[0]+" "+formatDate(e.dateArrive).split(" ")[1]}</h5>
                </div>`;
            }
            html+=`<div class="col-12 product_list" data-cat="${e?.suplier?.toLowerCase()}" style="padding:4px 1px">
              <div class="col-12" style="background:#FFF;border-radius:10px;padding:10px;border:1px solid #333">
                <button class="btn btn_delete" style="float:right;border:1px solid #000;padding:4px 10px;margin-left:3px" data="${e.id}"><i class="zmdi zmdi-delete"></i></button>
                <a style="margin:0px;float:right;background:black;color:#FFF;padding:3px;border-radius:3px;font-size:.8em"><b>$${formatPrice(e.price)}</b></a>
                <p style="margin:0px;font-size:.75em"><b>${e.suplier || "-"}</b></p>
                <h5 style="font-size:1.05em;margin:0px">${e.product} <b>(x${e.qty})</b></h5>
                <p style="margin:0px;font-size:.75em"><b>${e.code} || ${formatDate(e.date,false)}</b></p>
              </div>
              </div>`;
              if(suppliers.indexOf(e?.suplier?.toLowerCase())<0 && e.suplier){suppliers.push(e.suplier.toLowerCase())}
          });
          $("#products").html(html)
          html=`<button class="btn btn_cat" data-cat="all"  style="padding:5px 10px;border-radius:100px;background:#333;color:#FFF;margin:3px;width:100px;border:1px solid #333">ALL</button>`
          suppliers.forEach(e => {
            html+=`<button class="btn btn_cat" data-cat="${e.toLowerCase()}" style="padding:5px 10px;border-radius:100px;background:#EAEAEA;color:#000;margin:3px;width:100px;border:1px solid #333">${e.substr(0,8)}${e.length<8?"":".."}</button>`
          });
          $("#categories").css("width",`${(suppliers.length+1)*106}px`)
          $("#categories").html(html);
          $(".btn_cat").on("click",function () {
            $(".btn_cat").css("background","#EAEAEA").css("color","#000")
            $(this).css("background","#333").css("color","#FFF")
            suppliersSelected=$(this).attr("data-cat");
            $("#txt_buscar").val("")
            checkcoincidir()
          })
          $(".btn_delete").on("click",function () {  
            n1=Math.floor(Math.random() * 6);
            n2=Math.floor(Math.random() * 6);
            $("#deleteModal").modal('show')
            $("#n1").html(n1);$("#n2").html(n2);
            $("#delete_id").val($(this).attr('data'))
            $("#delete_sum").val(n1+n2)
            $("#delete_problem").html("");
            $("#delete_rta").val("");
            $("#delete_rta").focus()
          })
          capa(1)
          getSuppliers()
        }})
    }
    getRegistros()

    const sendDelete=()=>{
      n1=$("#delete_sum").val();n2=$("#delete_rta").val()
      if(n1!=n2){$("#delete_problem").html("Incorrect answer");return false;}
      $.ajax({
      url: '/deleteproduct', // URL del servidor donde se enviarán los datos
      type: 'POST',
      data: JSON.stringify({regId:$("#delete_id").val()}),
      contentType: 'application/json',
      success: function(r) {
        getRegistros();
        $("#deleteModal").modal('hide')
        
      }})
    }

    const getSuppliers=()=>{
      $.ajax({
        url: '/getsuppliers', // URL del servidor donde se enviarán los datos
        type: 'POST',
        data: JSON.stringify({}),
        contentType: 'application/json',
        success: function(r) {
          html=`<option value="NO" style="background:#000;color:#FFF">Choose Supplier</option>
                <option value="" style="background:#000;color:#FFF">New Supplier</option>`
          r?.data?.forEach(e => {
            if(e?.trim()!=""){html+=`<option value="${e}" style="background:#000;color:#FFF">${e}</option>`}
          });
          $("#old_suppliers").html(html)
        }})
    }
    $(".btn_date").on("click",function () {
      $(".btn_date").css("background","#EAEAEA").css("color","#000")
      $(this).css("background","#333").css("color","#FFF")
    })
    $(document).find(".btn_date").eq(0).click()

    //Setting filtros
    btn_filter=localStorage.getItem('btn_filter');
    if(!btn_filter){btn_filter=3;}
    $('.btn_filter').css('background','#4e4e4e');$('#btn_filter_'+btn_filter).css('background','#FFCC00');
    $('.btn_filter').on("click",function(){ 
      $('.btn_filter').css('background','#4e4e4e');
      $(this).css('background','#FFCC00');
      btn_filter=$(this).attr("data")
      initsearch();
    })
    //Setting user
    user_id=localStorage.getItem('user_id');
    if(!user_id){user_id=generarCodigo(30);localStorage.setItem('user_id',user_id);}
    $(".user_id").html(user_id)

    capa("00")
    function compararCadenas(str1, str2) {
      const set1 = new Set(str1.split(''));
      coin=0;total=0;
      set1.forEach(e => {
        c1=str1.split('').filter(a=>a==e).length;
        c2=str2.split('').filter(a=>a==e).length;
        max=Math.max(c1,c2);
        dif=Math.abs(c1-c2);
        total+=max;
        coin+=(max-dif);
        
      });
      rta=coin/total;
      //console.log()
      return rta;
    }

    function act(ids,valor){
      var settings = {
      "url": "/cambios",
      "method": "POST",
      "timeout": 0,
      "headers": {
        "Content-Type": "application/json"
      },
      "data": JSON.stringify({ids,valor}),
    };

    $.ajax(settings).done(function (response) {
      console.log(response);
      initsearch()
    });
    }

    let dejodeescribir;
    function checkcoincidir() {
        txt=$("#txt_buscar").val();
        clearInterval(dejodeescribir)
        dejodeescribir=setInterval(()=>{
          $(".product_list").show()
          $(".product_list").each(function(s){
            select=true;
            if($(this).html().toLowerCase().indexOf(txt.toLowerCase())<0){
              $(this).hide()
              select=false;
            }
            if(suppliersSelected!=$(this).attr("data-cat") && suppliersSelected!="all"){
              $(this).hide();
              select=false;
            }
            if(select){console.log(suppliersSelected===$(this).attr("data-cat") && suppliersSelected!="all",suppliersSelected,$(this).attr('data-cat'))
            }
          });
          clearInterval(dejodeescribir)
        },300)
     }
     $("#txt_buscar").on("keyup",function(){checkcoincidir()})


     $(window).on("load",()=>{
      $(".capa_1").css("padding-top",($(".fixed-top").height()+20)+"px");
      if($(window).width()<592){
        $(".row").css("margin","0px")
      }
     })


     function generarCodigo(longitud) {
      const caracteres = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      let codigo = "";

      for (let i = 0; i < longitud; i++) {
        const caracterAleatorio = caracteres.charAt(Math.floor(Math.random() * caracteres.length));
        codigo += caracterAleatorio;
      }

      return codigo;
    }
    function formatDate(dateInput,dayShow=true) {
      // Asegurarse de que dateInput es un objeto Date
      const date = new Date(dateInput);

      // Verificar si la conversión fue exitosa
      if (isNaN(date.getTime())) {
        throw new Error("Invalid date input");
      }

      const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
      const monthsOfYear = ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"];
      
      const dayName = daysOfWeek[date.getUTCDay()]; // Obtiene el día de la semana en texto
      const day = date.getUTCDate().toString().padStart(2, '0'); // Obtiene el día del mes y lo formatea con dos dígitos
      const month = monthsOfYear[date.getUTCMonth()]; // Obtiene el mes en número
      const year = date.getUTCFullYear().toString().slice(-2); // Obtiene los últimos dos dígitos del año
      const hours = date.getUTCHours().toString().padStart(2, '0'); // Obtiene la hora y lo formatea con dos dígitos
      const minutes = date.getUTCMinutes().toString().padStart(2, '0'); // Obtiene los minutos y lo formatea con dos dígitos
      if(dayShow){
      return `${dayName} ${day}/${month}/${year} ${hours}:${minutes}`;
      }else{
        return `${day}/${month}/${year} ${hours}:${minutes}`;
      }
    }
    function formatPrice(input) {
      // Usar una expresión regular para reemplazar cualquier carácter que no sea un número, '.', o ',' por una cadena vacía
      const cleanedString = input.replace(/[^0-9.,]/g, '');
      return cleanedString;
    }
    function areDatesSameDay(date1, date2) {
      const d1 = new Date(date1);
      const d2 = new Date(date2);

      return (
        d1.getUTCFullYear() === d2.getUTCFullYear() &&
        d1.getUTCMonth() === d2.getUTCMonth() &&
        d1.getUTCDate() === d2.getUTCDate()
      );
    }
    
    </script>
</body>
</html>
